<!--
title: Delete LIMIT
description: 
published: true
date: 2024-11-25T12:04:49.650Z
tags: 
editor: ckeditor
dateCreated: 2024-11-25T12:04:06.055Z
-->

<h1>Команда DELETE в Postgres не позволяет исползовать LIMIT</h1>
<p>Postgres, мощная и универсальная система реляционных баз данных, не поддерживает предложение LIMIT непосредственно в операторе DELETE. Это может быть ограничением, если вы хотите удалить определенное количество строк из таблицы без написания сложных запросов или сценариев.<br><br>Итак, как можно добиться аналогичной функциональности в Postgres? Давайте рассмотрим два распространенных обходных пути.</p>
<h2>Решение 1. Используйте DELETE с WHERE IN и SELECT.</h2>
<p>Один из способов удалить ограниченное количество строк в Postgres — объединить оператор DELETE с условием WHERE, которое использует предложение IN вместе с подзапросом. Вот как вы можете удалить только 1 строку для идентификатора пользователя 2, аналогично приведенному выше примеру MySQL:</p>
<pre><code class="language-plaintext">DELETE FROM quote 
WHERE id IN (SELECT id  FROM quote WHERE author_id = 2 LIMIT 1)</code></pre>
<p>В этом примере вы используете подзапрос для выбора идентификаторов строк из таблицы котировок, которые вы хотите удалить, ограничивая набор результатов одной строкой. Затем вы используете оператор DELETE с предложением WHERE, которое указывает идентификаторы, которые необходимо удалить. Это эффективно ограничивает количество удаленных строк до 1 для идентификатора пользователя 2. Это больше похоже на конвейерную передачу в bash, где выходные данные одной команды используются в качестве входных данных для следующей команды.<br><br>Этот подход обеспечивает обходной путь для достижения желаемого результата, но важно отметить, что он может быть не самым эффективным решением для больших таблиц. Подзапрос в предложении IN может повлиять на производительность, особенно при работе с обширными наборами данных. Вам также нужно будет подумать об эффектах CASCADE, когда может показаться, что удаляется только одна строка, но из-за связанных строк и других строк, связанных с дочерними строками, он также может удалить сотни или тысячи строк.&nbsp;</p>
<h2>Решение 2. Используйте общее табличное выражение (Common Table Expression - CTE)</h2>
<p>Другой подход к выполнению ограниченной операции DELETE в Postgres — использование общего табличного выражения (CTE). CTE позволяет вам определить временный набор результатов, на который вы можете ссылаться в операторе DELETE. Вот как вы можете использовать его, чтобы удалить только 1 цитату для идентификатора автора 2:</p>
<pre><code class="language-plaintext">WITH rows_to_delete AS (
    SELECT id
    FROM quot
    WHERE author_id=2
    LIMIT 1
    )
DELETE FROM quoteWHERE id IN (SELECT id FROM rows_to_delete);</code></pre>
<p>В этом решении вы сначала создаете CTE под названием «rows_to_delete», который выбирает идентификаторы удаляемых строк, ограниченный одной строкой для идентификатора автора 2. Затем вы используете оператор DELETE с предложением WHERE, которое ссылается на CTE для выполнить удаление.<br><br>Использование CTE может быть более эффективным и чистым способом достижения желаемого результата по сравнению с подходом с подзапросами. Он разделяет логику запроса на отдельные части, что упрощает чтение и обслуживание запроса. К этому методу применима та же логика каскадного удаления.&nbsp;</p>
<p><a href="https://geshan.com.np/blog/2023/09/postgres-delete-limit/"><span class="text-tiny">Источник.</span></a></p>

<!--
title: MegaCLI
description: полезные команды
published: true
date: 2023-04-21T11:37:43.034Z
tags: 
editor: ckeditor
dateCreated: 2023-04-21T11:23:51.199Z
-->

<p>&nbsp;</p>
<p><strong>RAID контроллерами MegaRAID фирмы LSI, теперь это Broadcom, можно управлять в линуксе из консоли используя утелиту MegaCLI, Загрузить которую можно </strong><a href="https://docs.broadcom.com/docs/12351587"><strong>тут</strong></a><strong>. &nbsp;Вот несколько полезных команд:</strong></p>
<p>Просмотр информации об адаптере RAID</p>
<p>&nbsp;</p>
<p>Для проверки версии прошивки, наличия блока резервного питания, установленной кэш-памяти и возможностей адаптера:</p>
<p>&nbsp;</p>
<p># MegaCli64 -AdpAllInfo -aAll</p>
<p>Просмотр информации о состоянии резервного аккумулятора</p>
<p>&nbsp;</p>
<p># MegaCli64 -AdpBbuCmd -aAll</p>
<p>Просмотр информации о виртуальных дисках</p>
<p>&nbsp;</p>
<p>Полезно для проверки уровня RAID, размера полосы, политики кэширования и состояния RAID:</p>
<p>&nbsp;</p>
<p># MegaCli64 -LDInfo -Lall -aALL</p>
<p>Просмотр информации о физических дисках</p>
<p>&nbsp;</p>
<p># MegaCli64 -PDList -aALL</p>
<p>Патруль читать</p>
<p>&nbsp;</p>
<p>Патрульное чтение — это функция, которая пытается обнаружить ошибку диска до того, как станет слишком поздно и данные будут потеряны. По умолчанию это делается автоматически (с задержкой в ​​168 часов между разными патрульными чтениями) и занимает до 30% ресурсов ввода-вывода.</p>
<p>&nbsp;</p>
<p>Чтобы просмотреть информацию о состоянии чтения патруля и задержке между запусками чтения патруля:</p>
<p># MegaCli64 -AdpPR -Info -aALL</p>
<p>&nbsp;</p>
<p>Чтобы узнать текущую скорость чтения патруля, выполните</p>
<p># MegaCli64 -AdpGetProp PatrolReadRate -aALL</p>
<p>&nbsp;</p>
<p>Чтобы уменьшить использование ресурсов патрулирования для чтения до 2%, чтобы свести к минимуму влияние на производительность:</p>
<p># MegaCli64 -AdpSetProp PatrolReadRate 2 -aALL</p>
<p>&nbsp;</p>
<p>Чтобы отключить автоматическое патрулирование, прочитайте:</p>
<p># MegaCli64 -AdpPR -Dsbl -aALL</p>
<p>&nbsp;</p>
<p>Чтобы начать ручной патруль, прочитайте сканирование:</p>
<p># MegaCli64 -AdpPR -Start -aALL</p>
<p>&nbsp;</p>
<p>Чтобы остановить патруль, прочитайте сканирование:</p>
<p># MegaCli64 -AdpPR -Stop -aALL</p>
<p>&nbsp;</p>
<p>Вы можете использовать приведенные выше команды для запуска патрульного чтения в непиковое время.</p>
<p>Миграция с одного уровня RAID на другой</p>
<p>&nbsp;</p>
<p>В этом примере я переношу виртуальный диск 0 с уровня RAID 6 на RAID 5, чтобы освободить место на одном дополнительном диске. Вторая команда используется, чтобы заставить Linux определить новый размер диска RAID.</p>
<p>&nbsp;</p>
<p># /usr/local/sbin/MegaCli64 -LDRecon -Start -r5 -L0 -a0</p>
<p># echo 1 &gt; /sys/block/sda/device/rescan</p>
<p>Расширение существующего RAID-массива новым диском</p>
<p>&nbsp;</p>
<p>./MegaCli64 -LDRecon -Начать -r5 -Добавить -PhysDrv[32:3] -L0 -a0</p>
<p>Создайте новый виртуальный диск RAID 5 из набора новых жестких дисков.</p>
<p>&nbsp;</p>
<p>Сначала нам нужно указать корпус и номер слота жестких дисков, которые мы хотим использовать для нового диска RAID. Узнать их можно по первой команде. Затем я добавляю виртуальный диск с использованием RAID уровня 5, за которым следует список дисков, которые я хочу использовать, указанный в синтаксисе корпус:слот.</p>
<p>&nbsp;</p>
<p># MegaCli64 -PDList -aALL | egrep 'Adapter|Enclosure|Slot|Inquiry'</p>
<p># MegaCli64 -CfgLdAdd -r5'[252:5,252:6,252:7]' -a0</p>
<p>Расширение существующего RAID-массива новым диском</p>
<p>&nbsp;</p>
<p>Сначала проверьте идентификатор устройства корпуса и номер слота вновь добавленного диска с помощью приведенной выше команды. Затем мы реконструируем логический диск, добавляя новый диск. Для массива RAID 5 используется эта команда:</p>
<p>&nbsp;</p>
<p># MegaCli64 -LDRecon -Start -r5 -Add -PhysDrv[32:3] -L0 -a0</p>
<p>Посмотреть ход реконструкции</p>
<p>&nbsp;</p>
<p>При восстановлении массива RAID вы можете проверить его ход с помощью этой команды.</p>
<p># MegaCli64 -LDRecon ShowProg L0 -a0</p>
<p>&nbsp;</p>
<p>(замените L0 на L1 для второго виртуального диска и т. д.)</p>
<p>Настройте отключение кэша записи при выходе из строя батареи.</p>
<p>&nbsp;</p>
<p># MegaCli64 -LDSetProp NoCachedBadBBU -LALL -aALL</p>
<p>Изменить политику кэширования физического диска</p>
<p>&nbsp;</p>
<p>Если ваша система не подключена к ИБП, вам следует отключить кэш физического диска, чтобы предотвратить потерю данных.</p>
<p>&nbsp;</p>
<p># MegaCli -LDGetProp -DskCache -LAll -aALL</p>
<p>&nbsp;</p>
<p>Чтобы включить его (делайте это, только если у вас есть ИБП и резервные источники питания):</p>
<p>&nbsp;</p>
<p># MegaCli -LDGetProp -DskCache -LAll -aALL</p>

<!--
title: lm_sensors fine tuning
description: /etc/sensors.d - параметров
published: true
date: 2022-08-18T16:39:28.582Z
tags: linux, lm-sensors, lm_sensors, sensors, sensors.d
editor: ckeditor
dateCreated: 2022-08-18T15:42:24.556Z
-->

<p><span class="text-big"><i><u>Установка lm-sensors тут описываться не будет, а только настройка и использование.</u></i></span></p>
<p>Команда: <strong>sensors</strong> - распечатать информацию о датчиках</p>
<p><u>Синтаксис</u>:<br><strong>sensors [</strong> опции <strong>] [</strong> <i>chips</i> <strong>]</strong><br><strong>sensors -s [</strong> <i>chips</i> <strong>]</strong></p>
<p><strong>sensors --bus-list</strong></p>
<p><u>Описание</u><strong>:</strong><br><strong>sensors</strong> используется для отображения текущих показаний всех сенсорных чипов.<br><strong>sensors -s</strong> используется для установки всех ограничений, указанных в файле конфигурации.<br><strong>sensors --bus-list</strong> используются для генерации операторов шины, подходящих для файла конфигурации.</p>
<p><u>Опции</u>:</p>
<p><strong><u>-c, --config-file</u></strong> config-file … Укажите файл конфигурации. Если файл не указан, используется файл конфигурации по умолчанию. Используйте “-c /dev/null”, чтобы временно отключить этот файл конфигурации по умолчанию.</p>
<p><strong><u>-h, --config-file</u></strong> … Распечатать текст справки и выйти.</p>
<p><strong><u>-s, --set</u></strong> .. Выполнение операторов “set” в файле конфигурации. Вы должны быть “root”, чтобы выполнить это. Если этот параметр не указан, оператор “set” не выполняется.</p>
<p><strong><u>-A, --no-adapter</u></strong> .. не показывать адаптер для каждого чипа.</p>
<p><strong><u>-u</u></strong> … Сырой вывод. Этот режим предназначен только для отладки.</p>
<p><strong><u>-j</u></strong> … Вывод в формате JSON.</p>
<p><strong><u>-v</u></strong> … Распечатайте версию программы и выйдите.</p>
<p><strong><u>-f</u></strong> …Print the temperatures in degrees Fahrenheit instead of Celsius.</p>
<p><strong><u>--bus-list</u></strong> &nbsp;… Сгенерируйте операторы шины, подходящие для использования в /etc/sensors3.conf. Такие операторы шины необходимы только в том случае, если у вас есть несколько микросхем с одинаковым адресом на разных шинах одного типа. Поскольку номера шин обычно не гарантируют стабильность после перезагрузки, эти операторы позволяют обращаться к каждой шине по ее имени, а не по номеру.</p>
<p>Используйте “<strong>-</strong>” после “<strong>-c</strong>”, чтобы прочитать файл конфигурации со стандартного ввода. Если чипы не указаны, будет напечатана вся информация о чипах. Примеры названий чипов:</p>
<pre><code class="language-plaintext">lm78-i2c-0-2d *-i2c-0-2d
lm78-i2c-0-* *-i2c-0-*
lm78-i2c-*-2d *-i2c-*-2d
lm78-i2c-*-* *-i2c-*-*
lm78-isa-0290 *-isa-0290
lm78-isa-* *-isa-*
lm78-*</code></pre>
<p>&nbsp;</p>
<p><span class="text-big"><strong>Файл конфигурации:</strong><i><strong><u> /etc/sensors3.conf </u></strong></i><strong>(основной) и индивидуальный для чипа в каталоге</strong><i><strong><u> /etc/sensors.d</u></strong></i></span></p>
<h3>Описание</h3>
<p><i>Sensors3.conf</i> описывает, как <i>sensors</i> и, следовательно, все программы, использующие его, должны преобразовывать необработанные показания модулей ядра в реальные значения.</p>
<p>В данной системе может быть одна или несколько микросхем мониторинга оборудования. Каждый чип может иметь несколько функций. Например, LM78 контролирует 7 входов напряжения, 3 вентилятора и одну температуру. Имена функций стандартизированы. Типичные названия функций: in0, in1, in2... для входов напряжения, fan1, fan2, fan3... для вентиляторов и temp1, temp2, temp3... для входов температуры.<br><br>Каждая функция, в свою очередь, может иметь одну или несколько подфункций, каждая из которых представляет атрибут функции: входное значение, нижний предел, верхний предел, сигнал тревоги и т. д. Имена подфункций также стандартизированы. Например, первый вход напряжения (in0) обычно имеет подфункции in0_input (измеренное значение), in0_min (нижний предел), in0_max (верхний предел) и in0_alarm (флаг тревоги). Какие подфункции на самом деле присутствуют, зависит от конкретного типа чипа.<br><br>Файл конфигурации sensor3.conf позволит вам настроить каждую микросхему, функцию и подфункцию таким образом, чтобы это имело смысл для вашей системы.<br><br>В оставшейся части этого раздела описывается значение каждого оператора конфигурации.</p>
<h3>Chip&nbsp;</h3>
<p>Оператор <i>chip</i> выбирает, для каких чипов предназначены все следующие операторы вычисления, маркировки, игнорирования и установки. Выбор чипа остается в силе до следующего утверждения чипа. Пример:</p>
<blockquote>
  <p>chip "lm78-*" "lm79-*"</p>
</blockquote>
<p>Описание чипа строится из нескольких элементов, разделенных типом. Первый элемент — это тип микросхемы, второй элемент — имя шины, а третий элемент — шестнадцатеричный адрес микросхемы. Такие описания чипов печатаются командой <strong>sensors</strong> в первой строке для каждого чипа.<br><br>Имя шины: isa, pci, virtual, spi-* или i2c-N, где N — номер шины, связанный с оператором bus. Этот список не обязательно является исчерпывающим, так как в будущем может быть добавлена ​​поддержка других типов шин.<br><br>Вы можете заменить подстановочный знак * для каждого элемента. Обратите внимание, однако, что не имеет смысла указывать адрес без типа шины, поэтому адресная часть просто опускается, если тип шины не указан. Вот как бы вы выразили следующие совпадения:</p>
<pre><code class="language-plaintext">Чип LM78 по адресу 0x2d на шине I2C 1            lm78-i2c-1-2d
Чип LM78 по адресу 0x2d на любой шине I2C        lm78-i2c-*-2d
Микросхема LM78 по адресу 0x290 на шине ISA      lm78-isa-0290
Любой чип LM78 на шине I2C 1                     lm78-i2c-1-*
Любой LM78 на любой шине I2C                     lm78-i2c-*-*
Любой чип LM78 на шине ISA                       lm78-isa-*
Любой чип LM78                                   lm78-*
Любой чип по адресу 0x2d на шине I2C 1           *-i2c-1-2d
Любой чип по адресу 0x290 на шине ISA            *-isa-0290</code></pre>
<p>Если несколько утверждений чипа соответствуют определенному чипу, учитываются все они.</p>
<h3>Label</h3>
<p>Оператор <i>label</i> описывает, как должна вызываться функция. Функции без оператора метки просто называются по имени функции. Приложения могут использовать это для маркировки показаний, которые они представляют. Пример:</p>
<blockquote>
  <p>label in3 "+5V"</p>
</blockquote>
<p>Первый аргумент — это имя функции. Второй аргумент — это описание функции.</p>
<h3>Ignore</h3>
<p>Оператор <i>ignore</i> — это намек на то, что конкретную функцию следует игнорировать — вероятно, потому, что она возвращает фиктивные значения (например, потому что вентилятор или датчик температуры не подключены). Пример:</p>
<blockquote>
  <p>ignore fan1</p>
</blockquote>
<p>Единственным аргументом является имя функции. Обратите внимание, что это ничего не отключает в фактическом сенсорном чипе; он просто скрывает отображение данных.</p>
<h3>Compute</h3>
<p>Оператор <i>compute</i> описывает, как необработанное значение функции должно быть преобразовано в реальное значение и как реальное значение должно быть снова преобразовано обратно в необработанное значение. Это наиболее полезно для датчиков напряжения, потому что, как правило, чипы датчиков имеют ограниченный диапазон, и напряжения за пределами этого диапазона должны быть разделены (с использованием резисторов), прежде чем их можно будет контролировать. Пример:</p>
<blockquote>
  <p>compute in3 ((6.8/10)+1)*@, @/((6.8/10)+1)</p>
</blockquote>
<p>В приведенном выше примере показано, что входное напряжение разделено с помощью двух резисторов со значениями 6,8 Ом и 10 Ом соответственно. Подробности см. в разделе <strong>ДЕТАЛИ РАСЧЕТА НАПРЯЖЕНИЯ</strong> ниже.<br><br>Первый аргумент — это имя функции. Второй аргумент — это выражение, указывающее, как необработанное значение должно быть преобразовано в реальное значение; '@' здесь означает необработанное значение. Это формула, которая будет применяться при считывании значений с чипа. Третий аргумент — это выражение, указывающее, как реальное значение должно быть преобразовано обратно в необработанное значение; '@' здесь означает реальное значение. Это формула, которая будет применяться при записи значений в чип. Эти две формулы, очевидно, связаны и разделены запятой.<br><br>Оператор вычисления применяется ко всем подфункциям целевой функции, для которых это имеет смысл. Например, приведенный выше пример повлияет на подфункции in3_min и in3_max (которые являются значениями напряжения), но не на in3_alarm (который является логическим флагом).<br><br>В операторах вычисления поддерживаются следующие операторы:<br><br>+ - * / ( ) ^ '<br><br>^x означает <strong>exp</strong>(x) и 'x означает <strong>ln</strong>(x).<br><br>Вы можете использовать названия подфункций в этих выражениях; подставляются текущие показания. Вы должны быть осторожны, чтобы избежать циклических ссылок.<br><br>Если в какой-то момент требуется перевод между необработанным и реальным значением, но оператор вычисления не применяется, вместо этого используется перевод один на один.</p>
<h3>Set</h3>
<p>Оператор <i>set</i> используется для записи значения подфункции в <i>chip</i>. Конечно, не все значения подфункций могут быть установлены таким образом, в частности, входные значения и тревожные флаги не могут быть установлены. Действительные подфункции обычно являются минимальными/максимальными ограничениями. Пример:</p>
<blockquote>
  <p>set in3_min 5 * 0.95</p>
  <p>set in3_max 5 * 1.05</p>
</blockquote>
<p>В приведенном выше примере микросхема в основном настраивается таким образом, чтобы обеспечить отклонение в 5% для входной мощности +5 В.<br><br>Первый аргумент — это имя функции. Второй аргумент — это выражение, определяющее записанное значение. Если есть применяющий оператор вычисления, это значение передается его третьему аргументу, чтобы преобразовать его в необработанное значение.<br><br>Вы можете использовать названия подфункций в этих выражениях; подставляются текущие показания. Вы должны быть осторожны, чтобы избежать циклических ссылок.<br><br><code>Обратите внимание, что операторы set выполняются, после внесения изменений, надо обязательно запустить команду <strong>sensors</strong> с опцией <strong>-s</strong>.</code> Типичные приложения с графическими датчиками вообще не заботятся об этих утверждениях.</p>
<h3>Bus</h3>
<p>Оператор <i>bus</i> связывает описание адаптера I2C или SMBus с номером шины. Это позволяет ссылаться на адаптер в конфигурационном файле, независимо от фактического соответствия номеров шин и фактических адаптеров (которые могут меняться от момента к моменту). Пример:</p>
<blockquote>
  <p>bus "i2c-0" "SMBus PIIX4 adapter at e800"</p>
</blockquote>
<p>Первый аргумент — это номер автобуса. Это буквальный текст i2c-, за которым следует число. Поскольку в этом аргументе есть тире, его всегда нужно ставить в кавычки.<br><br>Второй аргумент — это имя адаптера, оно должно точно совпадать с именем адаптера, указанным в /sys/class/i2c-adapter/i2c-*/name. Его всегда следует заключать в кавычки, так как он наверняка будет содержать пробелы или тире.<br><br>Операторы шины могут быть разбросаны случайным образом по всему конфигурационному файлу; нет необходимости располагать линию шины перед местом, где упоминается ее привязка. Тем не менее, из соображений хорошего стиля мы предлагаем вам разместить все операторы шины вместе в верхней части файла конфигурации.<br><br>Запущенные <strong>sensors --bus-list</strong> сгенерируют эти строки для вас.<br><br>В случае, когда используется несколько файлов конфигурации, областью действия каждого оператора шины является файл конфигурации, в котором он был определен. Это позволяет иметь операторы шины во всех файлах конфигурации, которые не будут неожиданно мешать друг другу.</p>
<h3>Порядок следования операторов</h3>
<p>Операторы могут идти в любом порядке, однако рекомендуется ставить операторы “set fanX_div” перед операторами “set fanX_min”, даже если драйвер не сохраняет параметр fanX_min при изменении значения fanX_div. Если это делает драйвер, все равно лучше расположить операторы в таком порядке, чтобы избежать потери точности.</p>
<h3>Beeps</h3>
<p>Некоторые чипы поддерживают событие со звуковым предупреждением. При срабатывании события вы можете быть предупреждены звуковым сигналом через динамик компьютера. Помимо флагов звуковых сигналов для каждой функции, обычно есть главный переключатель управления звуковыми сигналами, позволяющий включать или отключать звуковые сигналы глобально. Включите звуковой сигнал, используя:</p>
<blockquote>
  <p>set beep_enable 1</p>
</blockquote>
<p>или отключить его, используя:</p>
<blockquote>
  <p>set beep_enable 0</p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
